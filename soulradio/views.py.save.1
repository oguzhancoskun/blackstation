from django.shortcuts import render
from django.http import HttpResponse
from django.shortcuts import render_to_response
from django.templatetags.static import static
import soundcloud

from django.template import Template, Context

# Create your views here.

def home(request):

	#search=raw_input('Find>>')

        client = soundcloud.Client(client_id='0c7ba7f850fd26aa4b6c0efc42e4838b')

        #tracks = client.get('/tracks', q=search, license='cc-by-sa')

        #for track in tracks:
        #       print track.title," - ",track.id

        #name=raw_input('Select>>')
	
	musicx=[]
	
	lst=['sofly-swagger-cut','hardwell-spaceman-out-now','ty-dolla-sign-paranoid-ft-b-o','edit-ants','']
	for l in lst:
        	play = client.get('/tracks/'+l)
        	
		s = client.get(play.stream_url, allow_redirects=False)	
	
		musicx.append(s.location)		

	s=Template(u'''
	<html>
	
		<head>
			<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
			{%load staticfiles%}
			
			<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.min.js"></script>				

			<script>

				var audio= document.createElement('audio');
                                var listm=[];
				{% for m in musicx %}
                                        listm.push("{{m}}");
                                {% endfor %}
				
				var frst = Math.floor(Math.random()*listm.length);
			
       	                        audio.setAttribute('src',listm[frst]);
                                audio.play();

				len = listm.length;
				audio.addEventListener('ended',function()
					{
						var rnd = Math.floor(Math.random()*listm.length);						

						this.src=listm[rnd];
                                                this.play();

					

					});                                
				

                        </script>


               </head>
		
		<body style='background:url({%static "back.jpg"%}); font-family: 'Lato', sans-serif;'>					

				<center>
					<div style='margin-top:200px;'>
						<img src='{%static "pistation.png"%}'/>
					</div>
				</center>
										
		</body>

		''')	
	
        #client.put('/me/favorites/%d' % track.id)

	b=Context({'musicx':musicx})
	html=s.render(b)

	return HttpResponse(html)
